var myApp=angular.module("MeanApp",["ui.router"]);myApp.config(function(o,e){e.otherwise("/"),o.state("app",{url:"/",views:{"header@":{templateUrl:"view/header.html",controller:"NavController"},content:{templateUrl:"view/home.html",controller:"HomeController"},footer:{templateUrl:"view/footer.html"}}}).state("app.aboutus",{url:"aboutus",views:{"header@":{templateUrl:"view/header.html",controller:"NavController"},"content@":{templateUrl:"view/aboutus.html",controller:"AboutUsController"}}}).state("app.login",{url:"login",views:{"header@":{templateUrl:"view/header.html",controller:"NavController"},"content@":{templateUrl:"view/login.html",controller:"LoginController"}}}).state("app.signup",{url:"signup",views:{"header@":{templateUrl:"view/header.html",controller:"NavController"},"content@":{templateUrl:"view/signup.html",controller:"SignupController"}}}).state("app.profile",{url:"profile",views:{"header@":{templateUrl:"view/header.html",controller:"NavController"},"content@":{templateUrl:"view/profile.html",controller:"ProfileController"}}})}),angular.module("MeanApp").controller("NavController",["$scope","authentication","$location",function(o,e,n){console.log("Running NavController"),o.isLoggedIn=e.isLoggedIn(),o.user=e.getUser(),o.userlogin={email:"",password:""},console.log("isloggedin is "+o.isLoggedIn),o.login=function(){e.login(o.userlogin).success(function(o){console.log("Login Successful!"),n.path("/profile")}).error(function(o){console.log("Login failed: "+o.message),alert("Login failed: "+o.message),n.path("/login")})},o.logout=function(){e.logout(),n.path("/")}}]).controller("HomeController",["$scope",function(o){console.log("Running HomeController")}]).controller("AboutUsController",["$scope",function(o){console.log("Running AboutusController")}]).controller("LoginController",["$scope","authentication","$location",function(o,e,n){console.log("Running LoginController"),o.userlogin={email:"",password:""},o.dataloading=!1,o.login=function(){o.dataloading=!0,e.login(o.userlogin).success(function(o){console.log("Login Successful!"),n.path("/profile")}).error(function(e){console.log("Login failed: "+e.message),alert("Login failed: "+e.message),n.path("/login"),o.dataloading=!1})}}]).controller("SignupController",["$scope","$location","authentication",function(o,e,n){console.log("Running SignupController");var t={firstName:"",lastName:"",email:"",password:""};o.dataloading=!1,o.user=t,o.register=function(){o.dataloading=!0,n.register(t).success(function(o){console.log("Registration Successful"),e.path("/profile")}).error(function(n){console.log("Registraion failed: "+n.message),alert("Registraion failed: "+n.message),e.path("/signup"),o.dataloading=!1})}}]).controller("ProfileController",["$scope","authentication","userProfilesvc","$location",function(o,e,n,t){console.log("Running ProfileController");var l=e.isLoggedIn();l?n.getProfile().success(function(e){o.user=e}).error(function(o){console.log(o)}):console.log("User is no longer logged in"),o.tokenValid=l}]),angular.module("MeanApp").service("authentication",["$http","$window",function(o,e){console.log("Running authentication");var n={},t=function(o){n=o},l=function(o){return e.localStorage["mean-app-token"]},r=function(){e.localStorage.removeItem("mean-app-token")},i=function(o){e.localStorage["mean-app-token"]=o},a=function(e){return console.log(e),o.post("/api/register",e).success(function(o){console.log("data is "+o),i(o.token)})},s=function(e){return o.post("/api/login",e).success(function(o){i(o.token)})},c=function(o){var n="",t="",l="";return o&&(n=o.split(".")[1],t=e.atob(n),l=JSON.parse(t)),l},u=function(){var o,e=l();return!!e&&(o=c(e),o.exp>Date.now()/1e3)},g=function(){var o,e=l();if(e)return o=c(e),{firstname:o.firstname,lastname:o.lastname,email:o.email}},p=function(){r()};this.setUser=t,this.getToken=l,this.removeToken=r,this.saveToken=i,this.register=a,this.login=s,this.parseToken=c,this.isLoggedIn=u,this.getUser=g,this.logout=p}]).service("userProfilesvc",["$http","authentication",function(o,e){var n=function(){var n=e.getToken();return o.get("/api/profile",{headers:{Authorization:"Bearer "+n}})};this.getProfile=n}]);